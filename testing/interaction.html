<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Interacting with the Gateway | blurple.js</title>
    <meta name="description" content="The blurple.js Discord Bot Framework">
    
    
    <link rel="preload" href="/assets/css/0.styles.12450888.css" as="style"><link rel="preload" href="/assets/js/app.b93dd761.js" as="script"><link rel="preload" href="/assets/js/2.539db6d0.js" as="script"><link rel="preload" href="/assets/js/18.dc7d900d.js" as="script"><link rel="prefetch" href="/assets/js/10.c1baf4b5.js"><link rel="prefetch" href="/assets/js/11.272d8218.js"><link rel="prefetch" href="/assets/js/12.d7a646f6.js"><link rel="prefetch" href="/assets/js/13.5ef8fdf8.js"><link rel="prefetch" href="/assets/js/14.875ca85f.js"><link rel="prefetch" href="/assets/js/15.2d841ac4.js"><link rel="prefetch" href="/assets/js/16.8a447661.js"><link rel="prefetch" href="/assets/js/17.6521d5b1.js"><link rel="prefetch" href="/assets/js/19.fe365774.js"><link rel="prefetch" href="/assets/js/20.9efcaae5.js"><link rel="prefetch" href="/assets/js/3.7cd31be2.js"><link rel="prefetch" href="/assets/js/4.9a0b8d47.js"><link rel="prefetch" href="/assets/js/5.5472dd5a.js"><link rel="prefetch" href="/assets/js/6.ebb2fa06.js"><link rel="prefetch" href="/assets/js/7.0c268178.js"><link rel="prefetch" href="/assets/js/8.f08833c4.js"><link rel="prefetch" href="/assets/js/9.068fa4ae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.12450888.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">blurple.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/testing/" class="nav-link router-link-active">Testing</a></div> <a href="https://github.com/blurplejs/runtime" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/testing/" class="nav-link router-link-active">Testing</a></div> <a href="https://github.com/blurplejs/runtime" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/testing/" class="sidebar-link">Testing</a></li><li><a href="/testing/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/testing/other-languages.html" class="sidebar-link">Other Languages</a></li><li><a href="/testing/interaction.html" class="active sidebar-link">Interacting with the Gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/testing/interaction.html#creating-models" class="sidebar-link">Creating Models</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/testing/interaction.html#get-random-entities" class="sidebar-link">Get random entities</a></li><li class="sidebar-sub-header"><a href="/testing/interaction.html#using-the-factory" class="sidebar-link">Using the factory</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="interacting-with-the-gateway"><a href="#interacting-with-the-gateway" aria-hidden="true" class="header-anchor">#</a> Interacting with the Gateway</h1> <p>Starting up a WebSocket server is easy enough, but also doesn't do anything useful for us just yet. For proper tests we want to interact with the server, create new models with certain data, trigger events (such as a user sending a message to a channel) and so forth.</p> <h2 id="creating-models"><a href="#creating-models" aria-hidden="true" class="header-anchor">#</a> Creating Models</h2> <p>The Gateway is connected to a store, which you can manipulate whenever you need to. A good idea for many tests is to seed the store, which generates a bunch of random entries for your bot to interact with. Keep in mind that the server does not automatically seed the store, so if you want to use the demo data, you are responsible for seeding it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> storage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@blurple/gateway'</span>

storage<span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Alternative specifying a seed so that your tests become predictable</span>
<span class="token comment">// by always creating the same data</span>
storage<span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token number">6472421</span><span class="token punctuation">)</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Whenever you call <code>storage.seed</code> it will remove all of its previous entries. If you add any models to the storage before seeding it, they will be gone afterwards.</p></div> <h3 id="get-random-entities"><a href="#get-random-entities" aria-hidden="true" class="header-anchor">#</a> Get random entities</h3> <p>If you need to get hold of a random object of certain type, you can use the storage's <code>random</code> method, which will return you a random entry it has stored with the given type:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> storage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@blurple/testing'</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
</code></pre></div><h3 id="using-the-factory"><a href="#using-the-factory" aria-hidden="true" class="header-anchor">#</a> Using the factory</h3> <p>Internally <code>storage.seed</code> uses its <code>factory</code> method, which generates a given number of random entries. When creating them, an optional constructor method is called that will override any random data they created themselves.</p> <p>Say you need five text channels in the same guild:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> storage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@blurple/testing'</span>

<span class="token keyword">let</span> guild <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token string">'guild'</span><span class="token punctuation">)</span>
storage<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'channel'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
    <span class="token string">'guild'</span> <span class="token operator">=&gt;</span> guild<span class="token punctuation">.</span>id
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/blurplejs/docs/edit/master/docs/testing/interaction.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last updated: </span> <span class="time">2/21/2019, 12:30:59 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ‚Üê
        <a href="/testing/other-languages.html" class="prev">
          Other Languages
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b93dd761.js" defer></script><script src="/assets/js/2.539db6d0.js" defer></script><script src="/assets/js/18.dc7d900d.js" defer></script>
  </body>
</html>
